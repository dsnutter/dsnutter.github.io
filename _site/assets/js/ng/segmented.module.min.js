angular.module("lec.segmented",[]).constant("lec.segmented.constants",{segments:new Array(6,8,9,10,12,15,18,20,24,30,36,40,45,60,72,90,120)}).factory("lec.segmented.service.calculate",function(){return{cutAngle:function(a){return!(isNaN(parseFloat(a))||a<=0)&&360/a/2},circumference:{diameterBased:function(a){return!isNaN(parseFloat(a))&&a*Math.PI},segmentLengthBased:function(a,b){return!isNaN(parseFloat(a))&&!isNaN(parseFloat(b))&&a*b}}}}).factory("lec.segmented.service.draw",function(){var a,b,c,d,e,f,g,h,j,k,l,m,n;return{initialize:function(c){a=c,b=a.getContext("2d"),this.clear()},context:function(){return b},clear:function(){b.clearRect(0,0,a.width,a.height),d=30,e=a.width/3-d,f={x:a.width/2,y:a.height/2},j=[],k=[],l=e-40,m=e+40},ringWithLabels:function(a){void 0!=b&&(this.clear(),this.ring(a),this.curves(),this.labels(a))},ring:function(a){if("undefined"==typeof a||a<6)throw new Error("numberSides not defined");c=2*Math.PI/a,b.beginPath(),b.moveTo(f.x+m,f.y);for(var d,e,g=1;g<=a;g++)d=f.x+m*Math.cos(c*g),e=f.y+m*Math.sin(c*g),b.lineTo(d,e),k[k.length]=new Array(d,e);b.moveTo(f.x+l,f.y);for(var h,i,g=1;g<=a;g++)h=f.x+l*Math.cos(c*g),i=f.y+l*Math.sin(c*g),b.lineTo(h,i),j[j.length]=new Array(h,i);n=new Array;for(var g=0;g<j.length;g++)b.moveTo(j[g][0],j[g][1]),b.lineTo(k[g][0],k[g][1]),n[g]=(k[g][1]-j[g][1])/(k[g][0]-j[g][0]);b.closePath(),b.lineWidth=2,b.strokeStyle="black",b.stroke()},curves:function(){var a=k[1][0]-k[0][0],b=k[1][1]-k[0][1];Math.sqrt(Math.pow(a,2)+Math.pow(b,2));g=Math.sqrt(Math.pow(k[0][0]-f.x,2)+Math.pow(k[0][1]-f.y,2)),angle=c/2,h=Math.cos(angle)*g,this.curve(f,h,"red"),this.curve(f,e,"blue")},curve:function(a,c,d){b.beginPath(),b.arc(a.x,a.y,c,0,2*Math.PI,!1),b.lineWidth=2,b.strokeStyle=d,b.stroke()},labels:function(a){var b="red",c="A",l=f.y-g-d,m={x:f.x-h,y:l},o={x:f.x+h,y:l},p={x:0,y:-5};this.label(m,o,b,c,p),b="blue",c="B",l+=3*d/4,m={x:f.x-e,y:l},o={x:f.x+e,y:l},this.label(m,o,b,c,p),p={x:10,y:a>20?10:15},lineOffset=a>30?25:10;var t,q=k[1][0]-k[0][0],r=k[1][1]-k[0][1],s=r/q;if(0==s)x1=k[0][0],x2=k[1][0],y1=k[0][1]+lineOffset,y2=k[1][1]+lineOffset;else{var u=Math.atan(-1*s),v={x:(k[1][0]+k[0][0])/2,y:(k[1][1]+k[0][1])/2};t={x:v.x+lineOffset*Math.cos(u),y:v.y+lineOffset*Math.sin(u)},i=0,n[i]==1/0?x1=k[i][0]:x1=(n[i]*k[i][0]-k[i][1]-s*t.x+t.y)/(n[i]-s),y1=s*x1-s*t.x+t.y,i=1,n[i]==1/0?x2=k[i][0]:x2=(n[i]*k[i][0]-k[i][1]-s*t.x+t.y)/(n[i]-s),y2=s*x2-s*t.x+t.y}m={x:x1,y:y1},o={x:x2,y:y2},b="purple",c="C",this.label(m,o,b,c,p),b="orange",c="D",lineOffset=0,p={x:10,y:-10};var w=k[k.length-1],x=k[k.length-2];m={x:(w[0]+x[0])/2,y:(w[1]+x[1])/2};var y=j[j.length-1],z=j[j.length-2];o={x:(y[0]+z[0])/2,y:(y[1]+z[1])/2},this.label(m,o,b,c,p)},label:function(a,c,d,e,f){function g(a,c,d,e,f,g,h){e||(e="center"),h||(h=0);var k,l,i=d.x-c.x,j=d.y-c.y;if("center"==e)k=c,l=.5;else{var m="left"==e;k=m?c:d,l=h/Math.sqrt(i*i+j*j)*(m?1:-1)}b.save(),b.textAlign=e,b.translate(k.x+i*l,k.y+j*l),b.font="normal small-caps bold 15px arial",b.fillStyle=f,b.fillText(a,g.x,g.y),b.restore()}b.beginPath(),b.moveTo(a.x,a.y),b.lineTo(c.x,c.y),b.lineWidth=2,b.strokeStyle=d,b.stroke(),g(e,a,c,"center",d,f)}}}).directive("segmentedRing",["lec.segmented.service.draw",function(a){return{restrict:"A",template:'<canvas id="canvasSegmentedRingCalculatorResult" width="500" height="500" style="border: 1px solid; #000000"></canvas>',link:function(b,c){var d=c.find("canvas")[0];a.initialize(d)}}}]);